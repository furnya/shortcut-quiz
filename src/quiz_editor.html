<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shortcut Quiz</title>
  </head>

  <body>
    <script type="module">
      import { h, render, Component } from 'https://esm.sh/preact';
      import htm from 'https://esm.sh/htm';

      window.addEventListener('message', (event) => {
        const message = event.data; // The JSON data our extension sent
        let keybindings = [];
        if (message.command === 'setKeybindings') {
          keybindings = message.keybindings;
        }
        const html = htm.bind(h);

        // Create your app
        // const app = h('h1', null, 'Hello World!');
        class MyComponent extends Component {
          render(props, state) {
            return html`<div>
              ${keybindings.map(({ key, title }) => html`<h1>Key: ${key}, Title: ${title}</h1>`)}
            </div>`;
          }
        }
        function MyComponent2(props) {
          return html`<h1>Hello, ${props.name}!</h1>`;
        }

        // const app = html`<MyComponent name="World" />`;
        // const app = html`<MyComponent2 name="World" />`;
        const app = h(MyComponent, { names: ['a', 'b', 'c'] });

        render(app, document.body);
      });
      // const vscode = acquireVsCodeApi();
      const key = '{{KEY}}';
      // const key = document.getElementById('keyAnswer').innerText;

      const steps = [];
      let currentStep = 0;
      for (const step of key.split(' ')) {
        const keys = step.toLowerCase().split('+');
        steps.push(keys);
      }
      console.log(steps);

      export function showAnswer() {
        document.getElementById('answer').style.display = 'block';
      }
      window.showAnswer = showAnswer;

      document.addEventListener('keydown', (event) => {
        console.log(event.key);
        const step = steps[currentStep];
        console.log(step);
        const pressedKey = event.key.toLowerCase();
        if (
          (!step.includes('ctrl') || event.ctrlKey) &&
          (!step.includes('shift') || event.shiftKey) &&
          (!step.includes('alt') || event.altKey) &&
          (!step.includes('meta') || event.metaKey) &&
          !['ctrl', 'shift', 'alt', 'meta'].includes(pressedKey) &&
          step.includes(pressedKey)
        ) {
          event.preventDefault(); // Prevent VS Code from handling it
          event.stopPropagation(); // Stop propagation to parent elements
          currentStep++;
          if (currentStep === steps.length) {
            // Show a message in the Webview
            // vscode.postMessage({
            //   command: 'alert',
            //   text: 'You pressed the correct key combination!',
            // });
            document.getElementById('answer').style.display = 'block';
          }
        } else {
          currentStep = 0;
        }
      });
    </script>
    <!-- <h1>Shortcut Quiz</h1> -->
    <p>What is the shortcut for "{{TITLE}}"? ({{KEY}})</p>
    <p>Press the key combination or show the answer if you forgot:</p>
    <button onclick="showAnswer()">Show Answer</button>
    <p id="answer" style="display: none">
      The shortcut for "{{TITLE}}" is <strong id="keyAnswer">{{KEY}}</strong>
    </p>
  </body>
</html>
